{"version":3,"sources":["uni-app:///pages/quiz/quiz.vue","webpack:////Users/nuclearwaste/Documents/HBuilderProjects/paperPlay/pages/quiz/quiz.vue?bfcb","webpack:////Users/nuclearwaste/Documents/HBuilderProjects/paperPlay/pages/quiz/quiz.vue?e653","uni-app:///main.js",null,"webpack:////Users/nuclearwaste/Documents/HBuilderProjects/paperPlay/pages/quiz/quiz.vue?c85c","webpack:////Users/nuclearwaste/Documents/HBuilderProjects/paperPlay/pages/quiz/quiz.vue?30b4","webpack:////Users/nuclearwaste/Documents/HBuilderProjects/paperPlay/pages/quiz/quiz.vue?fb15"],"names":["data","paperId","questionPairs","currentPairIndex","leadInQuestion","conceptQuestion","showConceptQuestion","leadInSelectedOption","conceptSelectedOption","leadInShowResult","conceptShowResult","loading","startTime","leadInStartTime","conceptStartTime","computed","currentConceptName","leadInQuestionContent","leadInAnswerContent","conceptQuestionContent","conceptAnswerContent","isLeadInAnswerCorrect","isConceptAnswerCorrect","nextButtonText","onLoad","methods","goBack","uni","loadLevel","levelResponse","console","loadQuestionIds","questionsResponse","allQuestions","loadCurrentPair","Promise","leadInResponse","conceptResponse","resetQuestionState","fireBasicConfetti","particleCount","spread","origin","y","fireSchoolPride","opts","fire","startVelocity","x","setTimeout","selectLeadInOption","isCorrect","durationMs","answerJson","type","selected_option","correct_option","is_correct","title","icon","selectConceptOption","handleNext","duration","complete","getOptionLetter","isLeadInOptionCorrect","isConceptOptionCorrect","handleApiError","url","wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":"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","file":"pages/quiz/quiz.js","sourcesContent":["<template>\n\t<view class=\"quiz-container\">\n\t\t<!-- 顶部返回按钮 -->\n\t\t<view class=\"quiz-header\">\n\t\t\t<view class=\"back-btn\" @click=\"goBack\">\n\t\t\t\t<text class=\"back-icon\">←</text>\n\t\t\t\t<text>返回</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 骨骼屏动画 -->\n\t\t<view v-if=\"loading\" class=\"quiz-skeleton\">\n\t\t\t<view class=\"skeleton-title\"></view>\n\t\t\t<view class=\"skeleton-card\"></view>\n\t\t\t<view class=\"skeleton-card\"></view>\n\t\t\t<view class=\"skeleton-btn\"></view>\n\t\t</view>\n\n\t\t<view v-else>\n\t\t\t<!-- 当前题对的标题 -->\n\t\t\t<view class=\"concept-title\">\n\t\t\t\t{{ currentConceptName }}\n\t\t\t</view>\n\n\t\t\t<!-- 引入题部分 -->\n\t\t\t<view class=\"question-section\">\n\t\t\t\t<view class=\"question-type\">引入题</view>\n\t\t\t\t<view class=\"question-card\" :class=\"{ 'completed': showConceptQuestion }\">\n\t\t\t\t\t<view class=\"question-text\">{{ leadInQuestionContent.question }}</view>\n\t\t\t\t\t\n\t\t\t\t\t<view class=\"options-container\">\n\t\t\t\t\t\t<view v-for=\"(option, index) in leadInQuestionContent.options\" \n\t\t\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t\t\tclass=\"option\"\n\t\t\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t\t\t'selected': leadInSelectedOption === index,\n\t\t\t\t\t\t\t\t'correct': leadInShowResult && isLeadInOptionCorrect(index),\n\t\t\t\t\t\t\t\t'wrong': leadInShowResult && leadInSelectedOption === index && !isLeadInOptionCorrect(index)\n\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t\t@click=\"selectLeadInOption(index)\">\n\t\t\t\t\t\t\t{{ option }}\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\n\t\t\t\t\t<view v-if=\"leadInShowResult\" class=\"feedback-card\" \n\t\t\t\t\t\t:class=\"{ 'correct': isLeadInAnswerCorrect }\">\n\t\t\t\t\t\t<view class=\"feedback-text\">\n\t\t\t\t\t\t\t{{ leadInAnswerContent.explanation }}\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<!-- 概念题部分 -->\n\t\t\t<view v-if=\"showConceptQuestion\" class=\"question-section\">\n\t\t\t\t<view class=\"question-type\">概念题</view>\n\t\t\t\t<view class=\"question-card\">\n\t\t\t\t\t<!-- 概念解释 -->\n\t\t\t\t\t<view class=\"concept-explanation\">\n\t\t\t\t\t\t{{ conceptQuestionContent.concept_explanation }}\n\t\t\t\t\t</view>\n\n\t\t\t\t\t<view class=\"question-text\">{{ conceptQuestionContent.question }}</view>\n\t\t\t\t\t\n\t\t\t\t\t<view class=\"options-container\">\n\t\t\t\t\t\t<view v-for=\"(option, index) in conceptQuestionContent.options\" \n\t\t\t\t\t\t\t:key=\"index\"\n\t\t\t\t\t\t\tclass=\"option\"\n\t\t\t\t\t\t\t:class=\"{\n\t\t\t\t\t\t\t\t'selected': conceptSelectedOption === index,\n\t\t\t\t\t\t\t\t'correct': conceptShowResult && isConceptOptionCorrect(index),\n\t\t\t\t\t\t\t\t'wrong': conceptShowResult && conceptSelectedOption === index && !isConceptOptionCorrect(index)\n\t\t\t\t\t\t\t}\"\n\t\t\t\t\t\t\t@click=\"selectConceptOption(index)\">\n\t\t\t\t\t\t\t{{ option }}\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\n\t\t\t\t\t<view v-if=\"conceptShowResult\" class=\"feedback-card\" \n\t\t\t\t\t\t:class=\"{ 'correct': isConceptAnswerCorrect }\">\n\t\t\t\t\t\t<view class=\"feedback-text\">\n\t\t\t\t\t\t\t{{ conceptAnswerContent.explanation }}\n\t\t\t\t\t\t</view>\n\t\t\t\t\t</view>\n\t\t\t\t</view>\n\t\t\t</view>\n\n\t\t\t<!-- 下一步按钮 -->\n\t\t\t<button v-if=\"leadInShowResult && (!showConceptQuestion || conceptShowResult)\" \n\t\t\t\tclass=\"next-button\" \n\t\t\t\t@click=\"handleNext\">\n\t\t\t\t{{ nextButtonText }}\n\t\t\t</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\nimport { getPaperLevel } from '@/api/papers'\nimport { getLevelQuestions, startLevel, submitAnswer, completeLevel } from '@/api/levels'\nimport { getQuestion } from '@/api/questions'\nimport confetti from 'canvas-confetti'  // 添加这行\n\nexport default {\n  data() {\n    return {\n      paperId: '',\n      questionPairs: [], // [[id1, id2], [id3, id4], ...] 存储成对的问题ID\n      currentPairIndex: 0,\n      leadInQuestion: null, // 当前引入题\n      conceptQuestion: null, // 当前概念题\n      showConceptQuestion: false,\n      leadInSelectedOption: null,\n      conceptSelectedOption: null,\n      leadInShowResult: false,\n      conceptShowResult: false,\n      loading: false,\n      // 添加计时相关数据\n      startTime: null,\n      leadInStartTime: null,\n      conceptStartTime: null\n    }\n  },\n\n  computed: {\n    currentConceptName() {\n      if (!this.leadInQuestion) return ''\n      try {\n        return JSON.parse(this.leadInQuestion.content_json).concept_name\n      } catch (e) {\n        return ''\n      }\n    },\n\n    leadInQuestionContent() {\n      if (!this.leadInQuestion) return {}\n      try {\n        return JSON.parse(this.leadInQuestion.content_json)\n      } catch (e) {\n        return {}\n      }\n    },\n\n    leadInAnswerContent() {\n      if (!this.leadInQuestion) return {}\n      try {\n        return JSON.parse(this.leadInQuestion.answer_json)\n      } catch (e) {\n        return {}\n      }\n    },\n\n    conceptQuestionContent() {\n      if (!this.conceptQuestion) return {}\n      try {\n        return JSON.parse(this.conceptQuestion.content_json)\n      } catch (e) {\n        return {}\n      }\n    },\n\n    conceptAnswerContent() {\n      if (!this.conceptQuestion) return {}\n      try {\n        return JSON.parse(this.conceptQuestion.answer_json)\n      } catch (e) {\n        return {}\n      }\n    },\n\n    isLeadInAnswerCorrect() {\n      return this.getOptionLetter(this.leadInSelectedOption) === this.leadInAnswerContent.correct_option\n    },\n\n    isConceptAnswerCorrect() {\n      return this.getOptionLetter(this.conceptSelectedOption) === this.conceptAnswerContent.correct_option\n    },\n\n    nextButtonText() {\n      if (!this.showConceptQuestion) {\n        return this.isLeadInAnswerCorrect ? '查看概念题' : '重新作答'\n      }\n      return this.currentPairIndex < this.questionPairs.length - 1 ? '下一组题目' : '完成'\n    }\n  },\n\n  onLoad(options) {\n    if (options.id) {\n      this.paperId = options.id\n      this.startTime = Date.now()\n      this.loadLevel()\n    }\n  },\n\n  methods: {\n    goBack() {\n      uni.navigateBack();\n    },\n    async loadLevel() {\n      this.loading = true\n      try {\n        const levelResponse = await getPaperLevel(this.paperId)\n        \n        if (levelResponse.success) {\n          this.level = levelResponse.data\n          this.levelId = this.level.id // 保存 levelId\n          \n          // 开始关卡\n          try {\n            await startLevel(this.levelId)\n            console.log('关卡开始成功')\n          } catch (error) {\n            console.error('开始关卡失败:', error)\n            // 不阻止用户继续，只记录错误\n          }\n          \n          await this.loadQuestionIds(this.level.id)\n        }\n      } catch (error) {\n        console.error('获取关卡失败:', error)\n        this.handleApiError(error)\n      } finally {\n        this.loading = false\n      }\n    },\n\n    async loadQuestionIds(levelId) {\n      try {\n        const questionsResponse = await getLevelQuestions(levelId)\n        \n        if (questionsResponse.success) {\n          // 将问题ID两两配对\n          const allQuestions = questionsResponse.data\n          this.questionPairs = []\n          \n          for (let i = 0; i < allQuestions.length; i += 2) {\n            this.questionPairs.push([\n              allQuestions[i].id,\n              allQuestions[i + 1].id\n            ])\n          }\n          \n          // 加载第一个引入题\n          if (this.questionPairs.length > 0) {\n            await this.loadCurrentPair()\n          }\n        }\n      } catch (error) {\n        console.error('获取问题列表失败:', error)\n        this.handleApiError(error)\n      }\n    },\n\n    async loadCurrentPair() {\n      this.loading = true\n      try {\n        // 加载当前对的两个问题\n        const [leadInResponse, conceptResponse] = await Promise.all([\n          getQuestion(this.questionPairs[this.currentPairIndex][0]),\n          getQuestion(this.questionPairs[this.currentPairIndex][1])\n        ])\n\n        if (leadInResponse.success && conceptResponse.success) {\n          this.leadInQuestion = leadInResponse.data\n          this.conceptQuestion = conceptResponse.data\n          this.resetQuestionState()\n        }\n      } catch (error) {\n        console.error('加载题目失败:', error)\n        this.handleApiError(error)\n      } finally {\n        this.loading = false\n      }\n    },\n\n    resetQuestionState() {\n      this.showConceptQuestion = false\n      this.leadInSelectedOption = null\n      this.conceptSelectedOption = null\n      this.leadInShowResult = false\n      this.conceptShowResult = false\n      // 重置计时器\n      this.leadInStartTime = Date.now()\n    },\n\n    // 添加这两个新方法\n    fireBasicConfetti() {\n      confetti({\n        particleCount: 100,\n        spread: 70,\n        origin: { y: 0.6 }\n      });\n    },\n\n    fireSchoolPride() {\n      function fire(particleRatio, opts) {\n        confetti({\n          ...opts,\n          origin: { y: 0.7 },\n          particleCount: Math.floor(200 * particleRatio)\n        });\n      }\n\n      fire(0.25, {\n        spread: 26,\n        startVelocity: 55,\n        origin: { x: 0.2 }\n      });\n\n      fire(0.25, {\n        spread: 26,\n        startVelocity: 55,\n        origin: { x: 0.8 }\n      });\n\n      setTimeout(() => {\n        fire(0.2, {\n          spread: 60,\n          origin: { x: 0.2 }\n        });\n        fire(0.2, {\n          spread: 60,\n          origin: { x: 0.8 }\n        });\n      }, 150);\n    },\n\n    // 修改 selectLeadInOption 方法\n    async selectLeadInOption(index) {\n      if (this.leadInShowResult) return\n      \n      this.leadInSelectedOption = index\n      this.leadInShowResult = true\n      \n      const isCorrect = this.isLeadInOptionCorrect(index)\n      const durationMs = Date.now() - (this.leadInStartTime || this.startTime)\n      \n      // 提交答案 - 修改 answer_json 格式\n      try {\n        const answerJson = {\n          type: \"multiple_choice\",\n          selected_option: this.getOptionLetter(index),\n          correct_option: this.leadInAnswerContent.correct_option,\n          is_correct: isCorrect\n        }\n        \n        await submitAnswer(\n          this.levelId,\n          this.leadInQuestion.id,\n          answerJson,\n          durationMs\n        )\n      } catch (error) {\n        console.error('提交答案失败:', error)\n        // 不阻止用户继续，只记录错误\n      }\n      \n      if (isCorrect) {\n        this.showConceptQuestion = true\n        this.conceptStartTime = Date.now()\n      } else {\n        uni.showToast({ title: '答案错误', icon: 'none' })\n      }\n    },\n\n    // 修改 selectConceptOption 方法\n    async selectConceptOption(index) {\n      if (this.conceptShowResult) return\n      \n      this.conceptSelectedOption = index\n      this.conceptShowResult = true\n      \n      const isCorrect = this.isConceptOptionCorrect(index)\n      const durationMs = Date.now() - (this.conceptStartTime || this.startTime)\n      \n      // 提交答案 - 修改 answer_json 格式\n      try {\n        const answerJson = {\n          type: \"multiple_choice\",\n          selected_option: this.getOptionLetter(index),\n          correct_option: this.conceptAnswerContent.correct_option,\n          is_correct: isCorrect\n        }\n        \n        await submitAnswer(\n          this.levelId,\n          this.conceptQuestion.id,\n          answerJson,\n          durationMs\n        )\n      } catch (error) {\n        console.error('提交答案失败:', error)\n        // 不阻止用户继续，只记录错误\n      }\n      \n      if (isCorrect) {\n        this.fireBasicConfetti()\n      } else {\n        uni.showToast({ title: '答案错误', icon: 'none' })\n      }\n    },\n\n    // 修改 handleNext 方法\n    async handleNext() {\n      if (!this.showConceptQuestion) {\n        // 引入题部分\n        if (this.isLeadInAnswerCorrect) {\n          this.showConceptQuestion = true\n          this.conceptStartTime = Date.now()\n        } else {\n          this.leadInSelectedOption = null\n          this.leadInShowResult = false\n        }\n      } else if (this.conceptShowResult) {\n        // 概念题完成后\n        if (this.currentPairIndex < this.questionPairs.length - 1) {\n          this.currentPairIndex++\n          this.loadCurrentPair()\n        } else {\n          // 完成所有题目，提交关卡完成\n          try {\n            await completeLevel(this.levelId)\n            console.log('关卡完成提交成功')\n          } catch (error) {\n            console.error('提交关卡完成失败:', error)\n            // 不阻止用户继续，只记录错误\n          }\n          \n          this.fireSchoolPride()\n          uni.showToast({\n            title: '恭喜完成所有题目！',\n            icon: 'success',\n            duration: 2000,\n            complete: () => {\n              setTimeout(() => uni.navigateBack(), 2000)\n            }\n          })\n        }\n      }\n    },\n\n    getOptionLetter(index) {\n      return String.fromCharCode(65 + index)\n    },\n\n    isLeadInOptionCorrect(index) {\n      return this.getOptionLetter(index) === this.leadInAnswerContent.correct_option\n    },\n\n    isConceptOptionCorrect(index) {\n      return this.getOptionLetter(index) === this.conceptAnswerContent.correct_option\n    },\n\n    handleApiError(error) {\n      console.error('API错误:', error)\n      if (error.message === '请重新登录') {\n        uni.removeStorageSync('access_token')\n        uni.removeStorageSync('refresh_token')\n        uni.removeStorageSync('token_expires_in')\n        uni.removeStorageSync('userInfo')\n        \n        uni.showToast({\n          title: '请重新登录',\n          icon: 'none',\n          duration: 2000,\n          complete: () => {\n            setTimeout(() => {\n              uni.reLaunch({\n                url: '/pages/index/index'\n              })\n            }, 1000)\n          }\n        })\n      } else {\n        uni.showToast({\n          title: error.message || '发生错误',\n          icon: 'none'\n        })\n      }\n    }\n  }\n}\n</script>\n\n<style>\n.quiz-container {\n\tpadding: 30rpx;\n\tbackground-color: #f5f5f5;\n\tmin-height: 100vh;\n}\n\n.question-card {\n\tbackground: #ffffff;\n\tborder-radius: 20rpx;\n\tpadding: 40rpx;\n\tmargin-bottom: 30rpx;\n\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);\n}\n\n.question-text {\n\tfont-size: 32rpx;\n\tcolor: #333;\n\tline-height: 1.6;\n\tmargin-bottom: 30rpx;\n\tfont-weight: 500;\n}\n\n.options-container {\n\tdisplay: flex;\n\tflex-direction: column;\n\tgap: 20rpx;\n}\n\n.option {\n\tpadding: 24rpx;\n\tborder-radius: 12rpx;\n\tbackground: #f8f9fa;\n\tfont-size: 28rpx;\n\tcolor: #495057;\n\ttransition: all 0.3s ease;\n}\n\n.option.selected {\n\tbackground: #e7f5ff;\n\tcolor: #228be6;\n}\n\n.option.correct {\n\tbackground: #d3f9d8;\n\tcolor: #2b8a3e;\n}\n\n.option.wrong {\n\tbackground: #ffe3e3;\n\tcolor: #e03131;\n}\n\n.explanation-card {\n\tbackground: #fff3bf;\n\tborder-radius: 20rpx;\n\tpadding: 30rpx;\n\tmargin-bottom: 30rpx;\n}\n\n.explanation-card.final {\n\tbackground: #d3f9d8;\n}\n\n.explanation-text {\n\tfont-size: 28rpx;\n\tcolor: #495057;\n\tline-height: 1.6;\n}\n\n.concept-section {\n\tmargin-top: 40rpx;\n\tanimation: fadeIn 0.5s ease;\n}\n\n@keyframes fadeIn {\n\tfrom {\n\t\topacity: 0;\n\t\ttransform: translateY(20rpx);\n\t}\n\tto {\n\t\topacity: 1;\n\t\ttransform: translateY(0);\n\t}\n}\n\n/* 添加新的样式 */\n.concept-name {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #2c3e50;\n  margin-bottom: 20rpx;\n  padding-bottom: 20rpx;\n  border-bottom: 2rpx solid #eee;\n}\n\n.explanation-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  color: #2c3e50;\n  margin-bottom: 16rpx;\n}\n\n.feedback-card {\n  background: #fff3bf;\n  border-radius: 20rpx;\n  padding: 30rpx;\n  margin-bottom: 30rpx;\n}\n\n.feedback-card.correct {\n  background: #d3f9d8;\n}\n\n.feedback-text {\n  font-size: 28rpx;\n  color: #495057;\n  line-height: 1.6;\n}\n\n/* 添加新样式 */\n.question-type {\n  font-size: 32rpx;\n  color: #666;\n  text-align: center;\n  margin-bottom: 20rpx;\n  padding: 10rpx;\n  background: rgba(255, 255, 255, 0.8);\n  border-radius: 10rpx;\n}\n\n/* 添加新样式 */\n.question-section {\n  margin-bottom: 30rpx;\n}\n\n.concept-title {\n  font-size: 40rpx;\n  font-weight: bold;\n  color: #2c3e50;\n  text-align: center;\n  margin-bottom: 30rpx;\n  padding: 20rpx;\n  background: white;\n  border-radius: 16rpx;\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.1);\n}\n\n.question-card.completed {\n  opacity: 0.8;\n}\n\n.concept-explanation {\n  font-size: 28rpx;\n  color: #666;\n  background: #f8f9fa;\n  padding: 20rpx;\n  border-radius: 12rpx;\n  margin-bottom: 20rpx;\n  line-height: 1.6;\n}\n\n/* 在现有样式的最后添加 */\n.quiz-container {\n  position: relative;\n  z-index: 1;\n}\n\ncanvas {\n  position: fixed !important;\n  z-index: 999 !important;\n  pointer-events: none;\n}\n\n/* 顶部返回按钮样式 */\n.quiz-header {\n  display: flex;\n  align-items: center;\n  margin-bottom: 20rpx;\n}\n.back-btn {\n  display: flex;\n  align-items: center;\n  font-size: 32rpx;\n  color: #666;\n  padding: 10rpx 20rpx;\n  border-radius: 12rpx;\n  background: #fff;\n  box-shadow: 0 2rpx 8rpx rgba(0,0,0,0.06);\n  width: fit-content;\n  cursor: pointer;\n}\n.back-btn:active {\n  opacity: 0.7;\n}\n.back-icon {\n  font-size: 36rpx;\n  margin-right: 8rpx;\n}\n\n/* 骨骼屏动画样式 */\n.quiz-skeleton {\n  padding: 30rpx 0;\n}\n.skeleton-title {\n  width: 60%;\n  height: 48rpx;\n  background: #e0e0e0;\n  border-radius: 12rpx;\n  margin: 0 auto 32rpx auto;\n  animation: skeleton-loading 1.2s infinite linear alternate;\n}\n.skeleton-card {\n  width: 100%;\n  height: 180rpx;\n  background: #e0e0e0;\n  border-radius: 20rpx;\n  margin-bottom: 30rpx;\n  animation: skeleton-loading 1.2s infinite linear alternate;\n}\n.skeleton-btn {\n  width: 40%;\n  height: 60rpx;\n  background: #e0e0e0;\n  border-radius: 30rpx;\n  margin: 40rpx auto 0 auto;\n  animation: skeleton-loading 1.2s infinite linear alternate;\n}\n@keyframes skeleton-loading {\n  0% { background-color: #e0e0e0; }\n  100% { background-color: #f5f5f5; }\n}\n</style>","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./quiz.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./quiz.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1753568018556\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"/\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  ","import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/quiz/quiz.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./quiz.vue?vue&type=template&id=47015bb4&\"\nvar renderjs\nimport script from \"./quiz.vue?vue&type=script&lang=js&\"\nexport * from \"./quiz.vue?vue&type=script&lang=js&\"\nimport style0 from \"./quiz.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/quiz/quiz.vue\"\nexport default component.exports","export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./quiz.vue?vue&type=template&id=47015bb4&\"","var components\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = !_vm.loading\n    ? _vm.__map(_vm.leadInQuestionContent.options, function (option, index) {\n        var $orig = _vm.__get_orig(option)\n        var m0 = _vm.leadInShowResult && _vm.isLeadInOptionCorrect(index)\n        var m1 =\n          _vm.leadInShowResult &&\n          _vm.leadInSelectedOption === index &&\n          !_vm.isLeadInOptionCorrect(index)\n        return {\n          $orig: $orig,\n          m0: m0,\n          m1: m1,\n        }\n      })\n    : null\n  var l1 =\n    !_vm.loading && _vm.showConceptQuestion\n      ? _vm.__map(_vm.conceptQuestionContent.options, function (option, index) {\n          var $orig = _vm.__get_orig(option)\n          var m2 = _vm.conceptShowResult && _vm.isConceptOptionCorrect(index)\n          var m3 =\n            _vm.conceptShowResult &&\n            _vm.conceptSelectedOption === index &&\n            !_vm.isConceptOptionCorrect(index)\n          return {\n            $orig: $orig,\n            m2: m2,\n            m3: m3,\n          }\n        })\n      : null\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0,\n        l1: l1,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./quiz.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./quiz.vue?vue&type=script&lang=js&\""],"sourceRoot":""}